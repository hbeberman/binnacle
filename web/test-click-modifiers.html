<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Click Modifiers Test - Multi-Selection</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 2rem;
            margin: 0;
            display: flex;
            gap: 1rem;
        }
        #canvas-container {
            flex: 1;
            position: relative;
        }
        canvas {
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: default;
        }
        canvas.hovering {
            cursor: pointer;
        }
        canvas.dragging {
            cursor: grabbing;
        }
        canvas.dragging-node {
            cursor: move;
        }
        #info-panel {
            width: 300px;
            padding: 1rem;
            background: #f5f5f5;
            border-radius: 4px;
            overflow-y: auto;
        }
        .state-display {
            padding: 1rem;
            background: white;
            border-radius: 4px;
            margin-bottom: 1rem;
            font-family: monospace;
            font-size: 0.9rem;
        }
        .selected-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .selected-list li {
            padding: 0.25rem 0.5rem;
            margin: 0.25rem 0;
            background: #e6f2ff;
            border-left: 3px solid #0066cc;
            border-radius: 2px;
        }
        .instructions {
            margin-top: 1rem;
            padding: 1rem;
            background: #fff3cd;
            border-radius: 4px;
            font-size: 0.85rem;
        }
        .instructions h3 {
            margin-top: 0;
        }
        .instructions code {
            background: rgba(0,0,0,0.1);
            padding: 0.1rem 0.3rem;
            border-radius: 2px;
        }
        button {
            padding: 0.5rem 1rem;
            margin: 0.25rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: white;
            cursor: pointer;
        }
        button:hover {
            background: #f0f0f0;
        }
    </style>
</head>
<body>
    <div id="canvas-container">
        <canvas id="graph-canvas" width="800" height="600"></canvas>
    </div>
    
    <div id="info-panel">
        <h2>Selection State</h2>
        <div class="state-display">
            <div><strong>Count:</strong> <span id="selectionCount">0</span></div>
            <div><strong>Selected:</strong></div>
            <ul class="selected-list" id="selectedList"></ul>
        </div>
        
        <div>
            <h3>Actions</h3>
            <button id="btnClearSelection">Clear Selection</button>
            <button id="btnSelectAll">Select All</button>
        </div>
        
        <div class="instructions">
            <h3>Instructions</h3>
            <p><strong>Test the click modifiers:</strong></p>
            <ul>
                <li><code>Click</code> - Select only that node</li>
                <li><code>Ctrl/Cmd + Click</code> - Toggle selection</li>
                <li><code>Shift + Click</code> - Add to selection</li>
            </ul>
        </div>
    </div>

    <script type="module">
        import { subscribe, getSelectedNodes, toggleSelection, clearSelection, setSelectedNodes } from './js/state.js';
        import * as camera from './js/graph/camera.js';
        import { setNodes, render } from './js/graph/renderer.js';
        import { init as initTransform } from './js/graph/transform.js';

        const canvas = document.getElementById('graph-canvas');
        
        // Initialize transform
        initTransform(canvas);
        
        // Create test nodes in a grid pattern
        const testNodes = [
            { id: 'bn-test1', type: 'task', title: 'Task A', x: 100, y: 100, status: 'pending' },
            { id: 'bn-test2', type: 'task', title: 'Task B', x: 250, y: 100, status: 'in_progress' },
            { id: 'bn-test3', type: 'task', title: 'Task C', x: 400, y: 100, status: 'done' },
            { id: 'bn-test4', type: 'bug', title: 'Bug A', x: 100, y: 250, status: 'pending' },
            { id: 'bn-test5', type: 'bug', title: 'Bug B', x: 250, y: 250, status: 'in_progress' },
            { id: 'bn-test6', type: 'idea', title: 'Idea A', x: 400, y: 250, status: 'pending' },
            { id: 'bn-test7', type: 'task', title: 'Task D', x: 100, y: 400, status: 'pending' },
            { id: 'bn-test8', type: 'task', title: 'Task E', x: 250, y: 400, status: 'pending' },
            { id: 'bn-test9', type: 'milestone', title: 'Milestone A', x: 400, y: 400, status: 'pending' }
        ];
        
        // Set nodes and edges
        setNodes(testNodes, []);
        
        // Initialize camera controls
        camera.init(canvas, {
            onNodeHover: (node, x, y) => {
                // Could show tooltip here
            },
            onHoverEnd: () => {
                // Hide tooltip
            },
            onNodeDoubleClick: (node) => {
                console.log('Double clicked:', node.id);
            }
        });
        
        // Update display
        function updateDisplay() {
            const selectedNodes = getSelectedNodes();
            
            document.getElementById('selectionCount').textContent = selectedNodes.length;
            
            const selectedList = document.getElementById('selectedList');
            selectedList.innerHTML = '';
            
            if (selectedNodes.length === 0) {
                const li = document.createElement('li');
                li.textContent = '(none)';
                li.style.background = 'transparent';
                li.style.border = 'none';
                selectedList.appendChild(li);
            } else {
                selectedNodes.forEach(nodeId => {
                    const node = testNodes.find(n => n.id === nodeId);
                    const li = document.createElement('li');
                    li.textContent = `${nodeId} - ${node?.title || 'Unknown'}`;
                    selectedList.appendChild(li);
                });
            }
            
            // Trigger re-render to update visual selection
            render();
        }
        
        // Subscribe to selection changes
        subscribe('ui.selectedNodes', updateDisplay);
        
        // Action buttons
        document.getElementById('btnClearSelection').addEventListener('click', () => {
            clearSelection();
        });
        
        document.getElementById('btnSelectAll').addEventListener('click', () => {
            setSelectedNodes(testNodes.map(n => n.id));
        });
        
        // Initial render and display update
        render();
        updateDisplay();
        
        // Animation loop
        function animate() {
            render();
            requestAnimationFrame(animate);
        }
        animate();
    </script>
</body>
</html>
