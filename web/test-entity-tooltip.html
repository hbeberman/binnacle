<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entity Link Tooltip Test</title>
    
    <!-- Base styles -->
    <link rel="stylesheet" href="css/themes/dark.css">
    <link rel="stylesheet" href="css/components/graph.css">
    <link rel="stylesheet" href="css/components/activity-log.css">
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 2rem;
            margin: 0;
        }
        
        .test-container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .test-panel {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        h1 {
            color: var(--accent-blue);
            margin-top: 0;
        }
        
        .info {
            background: var(--bg-tertiary);
            border-left: 3px solid var(--accent-blue);
            padding: 0.75rem 1rem;
            margin: 1rem 0;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .test-content {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 1.5rem;
            line-height: 1.8;
        }
        
        p {
            margin: 0.5rem 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-panel">
            <h1>üîç Entity Link Tooltip Test</h1>
            <p class="info">
                ‚ÑπÔ∏è Hover over the entity IDs below to see tooltips with entity details.
                The tooltips should show: icon, ID, title, status badge, and description preview.
            </p>
            
            <div id="test-content" class="test-content">
                <h2>Sample Content with Entity Links</h2>
                
                <p>Working on task <strong>bn-6133</strong> which is about adding tooltips.</p>
                
                <p>This depends on completed task bn-0ef8 (entity ID linkification).</p>
                
                <p>Also related to tasks:</p>
                <ul>
                    <li>bn-9f63 - Frontend CSS updates</li>
                    <li>bn-a5e9 - Container info display</li>
                    <li>bn-74e1 - Real-time log streaming</li>
                </ul>
                
                <p>Test nodes: bnt-0001, bnt-0002</p>
                <p>Queue: bnq-e8b7</p>
                
                <h3>Instructions</h3>
                <p>Hover over any entity ID above to see a tooltip with its details!</p>
            </div>
        </div>
    </div>
    
    <script type="module">
        import * as State from './js/state.js';
        import { renderMarkdown } from './js/utils/markdown.js';
        import { init as initTooltip, setupEntityLinkHover } from './js/components/tooltip.js';
        
        // Setup mock state with sample entities
        State.set('entities.tasks', [
            {
                id: 'bn-6133',
                type: 'task',
                title: 'Add tooltip on entity link hover',
                short_name: 'entity hover tooltip',
                description: 'Show tooltip near cursor when hovering entity links. Display: entity type icon, ID, title, status badge, description preview (first ~50 chars).',
                status: 'in_progress',
                priority: 2
            },
            {
                id: 'bn-0ef8',
                type: 'task',
                title: 'Add entity ID detection and linkification',
                short_name: 'entity linkify',
                description: 'Detect binnacle entity IDs (bn-xxxx, bnt-xxxx, etc.) in text and make them clickable links.',
                status: 'done',
                priority: 1
            },
            {
                id: 'bn-9f63',
                type: 'task',
                title: 'Frontend: Add CSS for enhanced agent cards',
                short_name: 'Agent card CSS',
                description: 'Add CSS for health warning banners, action buttons, task link styling, and container info display.',
                status: 'pending',
                priority: 2
            },
            {
                id: 'bn-a5e9',
                type: 'task',
                title: 'Frontend: Display container info in cards',
                short_name: 'Container info display',
                description: 'Show container ID in agent cards when agent.container_id is present. Style appropriately.',
                status: 'pending',
                priority: 2
            },
            {
                id: 'bn-74e1',
                type: 'task',
                title: 'Frontend: Real-time streaming with pause',
                short_name: 'Log streaming',
                description: 'Implement real-time log streaming via WebSocket. Add pause/resume button, entry buffer when paused, new entry indicator.',
                status: 'pending',
                priority: 2
            }
        ]);
        
        State.set('entities.tests', [
            {
                id: 'bnt-0001',
                type: 'test',
                name: 'Tooltip display test',
                description: 'Verify tooltip appears on hover with correct content',
                status: 'pending'
            },
            {
                id: 'bnt-0002',
                type: 'test',
                name: 'Tooltip positioning test',
                description: 'Verify tooltip positions correctly near cursor and adjusts for viewport edges',
                status: 'pending'
            }
        ]);
        
        State.set('entities.queues', [
            {
                id: 'bnq-e8b7',
                type: 'queue',
                title: 'Work Queue',
                description: 'High priority work items for agents',
                status: 'active'
            }
        ]);
        
        // Initialize tooltips
        const container = document.body;
        initTooltip(container);
        
        // Linkify entity IDs in test content
        const testContent = document.getElementById('test-content');
        const contentHtml = testContent.innerHTML;
        
        // Simple linkification for testing (reusing the pattern from markdown.js)
        const ENTITY_ID_PATTERN = /\b(bn[a-z]?-[a-f0-9]{4})\b/gi;
        const linkifiedHtml = contentHtml.replace(ENTITY_ID_PATTERN, (match) => {
            return `<span class="clickable-entity-id" data-entity-id="${match}" title="Click to view ${match}">${match}</span>`;
        });
        
        testContent.innerHTML = linkifiedHtml;
        
        // Setup entity link hover tooltips
        setupEntityLinkHover(testContent);
        
        console.log('‚úÖ Entity tooltip test page loaded');
        console.log('üìç Mock entities loaded into state');
        console.log('üéØ Hover over entity IDs to see tooltips!');
    </script>
</body>
</html>
